<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>حاسبه سعرات الطعام - Popeye GYM</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #f5f5f5 0%, #e8e8e8 100%);
            min-height: 100vh;
            padding: 20px;
            direction: rtl;
            text-align: right;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #dc3545 0%, #c82333 100%);
            color: white;
            padding: 20px;
            text-align: center;
            position: relative;
        }

        .back-button {
            position: absolute;
            top: 50%;
            right: 20px;
            transform: translateY(-50%);
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 50px;
            padding: 12px 20px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .back-button:hover {
            background: rgba(255, 255, 255, 0.3);
            border-color: rgba(255, 255, 255, 0.5);
            transform: translateY(-50%) scale(1.05);
        }

        .logo {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 20px;
            margin-bottom: 10px;
        }

        .logo-img {
            width: 80px;
            height: 80px;
        }

        .logo h1 {
            font-size: 2.5rem;
            font-weight: bold;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
            margin: 0;
        }

        .subtitle {
            font-size: 1.1rem;
            opacity: 0.9;
            margin-top: 5px;
        }

        .main-content {
            padding: 30px;
        }

        .meal-section {
            background: #f8f9fa;
            border-radius: 12px;
            margin-bottom: 25px;
            border: 2px solid #e9ecef;
            transition: all 0.3s ease;
        }

        .meal-section:hover {
            border-color: #dc2626;
            box-shadow: 0 5px 15px rgba(220, 38, 38, 0.1);
        }

        .meal-header {
            background: linear-gradient(135deg, #dc3545 0%, #c82333 100%);
            color: white;
            padding: 15px 20px;
            font-size: 1.3rem;
            font-weight: bold;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .meal-content {
            padding: 20px;
        }

        .add-food-section {
            background: white;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            border: 1px solid #dee2e6;
        }

        .search-container {
            position: relative;
            margin-bottom: 15px;
        }

        .search-input {
            width: 100%;
            padding: 12px 20px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.3s ease;
            direction: rtl;
        }

        .search-input:focus {
            outline: none;
            border-color: #dc3545;
            box-shadow: 0 0 0 3px rgba(220, 53, 69, 0.1);
        }

        .search-results {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: white;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            max-height: 200px;
            overflow-y: auto;
            z-index: 1000;
            display: none;
        }

        .search-result-item {
            padding: 12px 15px;
            cursor: pointer;
            border-bottom: 1px solid #f1f3f4;
            transition: background-color 0.2s ease;
        }

        .search-result-item:hover {
            background-color: #f8f9fa;
        }

        .search-result-item:last-child {
            border-bottom: none;
        }

        .quantity-container {
            display: flex;
            gap: 15px;
            align-items: center;
            margin-top: 15px;
        }

        .quantity-input {
            padding: 8px 12px;
            border: 1px solid #dee2e6;
            border-radius: 6px;
            width: 100px;
            text-align: center;
        }

        .add-btn {
            background: linear-gradient(135deg, #dc3545 0%, #c82333 100%);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
        }

        .add-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(220, 53, 69, 0.3);
        }

        .food-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .food-table th,
        .food-table td {
            padding: 12px;
            text-align: center;
            border-bottom: 1px solid #e9ecef;
        }

        .food-table th {
            background: linear-gradient(135deg, #dc3545 0%, #c82333 100%);
            color: white;
            font-weight: bold;
        }

        .food-table tr:hover {
            background-color: #f8f9fa;
        }

        .remove-btn {
            background: #dc3545;
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.8rem;
        }

        .remove-btn:hover {
            background: #c82333;
        }

        .totals-section {
            background: linear-gradient(135deg, #dc3545 0%, #c82333 100%);
            color: white;
            padding: 20px;
            border-radius: 12px;
            margin: 30px 0;
            text-align: center;
        }

        .totals-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .total-item {
            background: rgba(255,255,255,0.2);
            padding: 15px;
            border-radius: 8px;
            backdrop-filter: blur(10px);
        }

        .total-value {
            font-size: 2rem;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .total-label {
            font-size: 0.9rem;
            opacity: 0.9;
        }

        .action-buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 30px;
            flex-wrap: wrap;
        }

        .btn {
            padding: 12px 30px;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-block;
        }

        .btn-primary {
            background: linear-gradient(135deg, #dc3545 0%, #c82333 100%);
            color: white;
        }

        .btn-secondary {
            background: linear-gradient(135deg, #6c757d 0%, #495057 100%);
            color: white;
        }

        .btn-danger {
            background: linear-gradient(135deg, #dc3545 0%, #c82333 100%);
            color: white;
        }

        .btn-success {
            background: linear-gradient(135deg, #dc3545 0%, #c82333 100%);
            color: white;
        }

        .btn-info {
            background: linear-gradient(135deg, #dc3545 0%, #c82333 100%);
            color: white;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        /* Mobile Responsive */
        @media (max-width: 768px) {
            body {
                padding: 10px;
            }

            .main-content {
                padding: 20px 15px;
            }

            .logo h1 {
                font-size: 2rem;
            }

            .food-table {
                font-size: 0.9rem;
            }

            .food-table th,
            .food-table td {
                padding: 8px 4px;
            }

            .totals-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 15px;
            }

            .quantity-container {
                flex-direction: column;
                align-items: stretch;
            }

            .action-buttons {
                flex-direction: column;
                align-items: center;
            }

            .btn {
                width: 100%;
                max-width: 300px;
            }
        }

        @media (max-width: 480px) {
            .logo {
                flex-direction: column;
                gap: 10px;
            }

            .logo svg {
                width: 50px;
                height: 50px;
            }

            .logo h1 {
                font-size: 1.8rem;
            }

            .food-table {
                font-size: 0.8rem;
            }

            .totals-grid {
                grid-template-columns: 1fr;
            }
        }

        .hidden {
            display: none;
        }

        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: linear-gradient(135deg, #dc3545 0%, #c82333 100%);
            color: white;
            padding: 15px 20px;
            border-radius: 8px;
            box-shadow: 0 5px 15px rgba(220, 53, 69, 0.3);
            z-index: 10000;
            transform: translateX(400px);
            transition: transform 0.3s ease;
            max-width: 300px;
            border: 2px solid rgba(255,255,255,0.2);
        }

        .notification.show {
            transform: translateX(0);
        }

        .notification.error {
            background: linear-gradient(135deg, #dc3545 0%, #c82333 100%);
            box-shadow: 0 5px 15px rgba(220, 53, 69, 0.3);
        }

        .notification.warning {
            background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
            color: white;
            box-shadow: 0 5px 15px rgba(245, 158, 11, 0.3);
        }

        .add-meal-section {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 25px;
            border: 2px dashed #dc3545;
            text-align: center;
        }

        .meal-name-input {
            width: 100%;
            padding: 12px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            font-size: 1rem;
            margin-bottom: 15px;
            direction: rtl;
        }

        .meal-name-input:focus {
            outline: none;
            border-color: #dc3545;
        }

        .table-container {
            overflow-x: auto;
        }

        /* Custom Modal Styles */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(5px);
            z-index: 10000;
            display: flex;
            align-items: center;
            justify-content: center;
            animation: fadeIn 0.3s ease;
        }

        .modal-content {
            background: white;
            border-radius: 15px;
            padding: 30px;
            max-width: 400px;
            width: 90%;
            text-align: center;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            animation: slideIn 0.3s ease;
            border: 3px solid #dc3545;
        }

        .modal-icon {
            font-size: 60px;
            margin-bottom: 20px;
            color: #dc3545;
        }

        .modal-title {
            font-size: 24px;
            font-weight: bold;
            color: #333;
            margin-bottom: 15px;
        }

        .modal-message {
            font-size: 16px;
            color: #666;
            margin-bottom: 30px;
            line-height: 1.5;
        }

        .modal-buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
        }

        .modal-btn {
            padding: 12px 25px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            min-width: 120px;
        }

        .modal-btn-confirm {
            background: linear-gradient(135deg, #dc3545 0%, #c82333 100%);
            color: white;
        }

        .modal-btn-confirm:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(220, 53, 69, 0.4);
        }

        .modal-btn-cancel {
            background: #6c757d;
            color: white;
        }

        .modal-btn-cancel:hover {
            background: #495057;
            transform: translateY(-2px);
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes slideIn {
            from { 
                opacity: 0;
                transform: translateY(-50px) scale(0.9);
            }
            to { 
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }

        @media (max-width: 480px) {
            .modal-content {
                padding: 20px;
                margin: 20px;
            }

            .modal-buttons {
                flex-direction: column;
            }

            .modal-btn {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <a href="index.html" class="back-button">
                <i class="fas fa-arrow-right"></i>
                العودة للموقع
            </a>
            <div class="logo">
                <img src="images/logo.png" alt="Popeye GYM Logo" class="logo-img">
                <h1>Popeye GYM</h1>
            </div>
            <div class="subtitle">حاسبة سعرات الطعام</div>
        </div>

        <!-- Main Content -->
        <div class="main-content">
            <!-- Add Meal Section -->
            <div class="add-meal-section">
                <h3>إضافة وجبة جديدة</h3>
                <input type="text" class="meal-name-input" id="new-meal-name" placeholder="اكتب اسم الوجبة (مثل: الإفطار، الغداء، وجبة خفيفة...)">
                <button class="btn btn-primary" onclick="addNewMeal()">إضافة الوجبة</button>
            </div>

            <!-- Meals Sections -->
            <div id="meals-container">
                <!-- Meals will be generated by JavaScript -->
            </div>

            <!-- Daily Totals -->
            <div class="totals-section">
                <h2>المجموع اليومي</h2>
                <div class="totals-grid">
                    <div class="total-item">
                        <div class="total-value" id="total-calories">0</div>
                        <div class="total-label">السعرات الحرارية</div>
                    </div>
                    <div class="total-item">
                        <div class="total-value" id="total-protein">0</div>
                        <div class="total-label">البروتين (جم)</div>
                    </div>
                    <div class="total-item">
                        <div class="total-value" id="total-carbs">0</div>
                        <div class="total-label">الكربوهيدرات (جم)</div>
                    </div>
                    <div class="total-item">
                        <div class="total-value" id="total-fats">0</div>
                        <div class="total-label">الدهون (جم)</div>
                    </div>
                    <div class="total-item">
                        <div class="total-value" id="total-fiber">0</div>
                        <div class="total-label">الألياف (جم)</div>
                    </div>
                </div>

                <!-- Action Buttons -->
                <div class="action-buttons">
                    <button class="btn btn-primary" onclick="saveDay()">💾 حفظ اليوم</button>
                    <button class="btn btn-primary" onclick="downloadPDF()">📄 تحميل PDF</button>
                    <button class="btn btn-primary" onclick="downloadImage()">🖼️ تحميل كصورة</button>
                    <button class="btn btn-danger" onclick="clearAll()">🗑️ مسح الكل</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Egyptian Foods Database - Extended Version
        const egyptianFoodsDatabase = [
            // Traditional Egyptian Foods
            { name: "فول مدمس", nameEn: "Fava Beans", calories: 187, protein: 12.9, carbs: 33, fats: 0.7, fiber: 9.9 },
            { name: "طحينة", nameEn: "Tahini", calories: 595, protein: 18, carbs: 21, fats: 54, fiber: 9.3 },
            { name: "حلاوة طحينية", nameEn: "Halva", calories: 469, protein: 12.7, carbs: 54, fats: 25, fiber: 3.9 },
            { name: "طعمية", nameEn: "Falafel", calories: 333, protein: 13.3, carbs: 31.8, fats: 17.8, fiber: 4.9 },
            { name: "كشري", nameEn: "Koshari", calories: 170, protein: 5.8, carbs: 32, fats: 2.5, fiber: 3.2 },
            { name: "ملوخية", nameEn: "Molokhia", calories: 58, protein: 5.6, carbs: 10, fats: 0.8, fiber: 4.2 },
            { name: "بامية", nameEn: "Okra", calories: 33, protein: 1.9, carbs: 7.5, fats: 0.2, fiber: 3.2 },
            { name: "مولوخية بالفراخ", nameEn: "Molokhia with Chicken", calories: 142, protein: 12.5, carbs: 8.2, fats: 7.3, fiber: 2.1 },
            { name: "مسقعة", nameEn: "Moussaka", calories: 145, protein: 6.2, carbs: 18, fats: 6.8, fiber: 4.1 },
            { name: "مدفونة", nameEn: "Madfona", calories: 285, protein: 15.8, carbs: 35, fats: 9.2, fiber: 3.5 },

            // Bread Types
            { name: "عيش بلدي", nameEn: "Baladi Bread", calories: 273, protein: 9, carbs: 56, fats: 1.2, fiber: 4.8 },
            { name: "عيش فينو", nameEn: "Fino Bread", calories: 265, protein: 8.5, carbs: 53, fats: 2.1, fiber: 3.2 },
            { name: "عيش شامي", nameEn: "Shami Bread", calories: 280, protein: 9.5, carbs: 58, fats: 1.8, fiber: 4.1 },
            { name: "بسكويت محشي", nameEn: "Stuffed Biscuits", calories: 485, protein: 8.2, carbs: 62, fats: 23, fiber: 2.8 },

            // Cheeses
            { name: "جبنة قريش", nameEn: "Cottage Cheese", calories: 98, protein: 11, carbs: 3.4, fats: 4.3, fiber: 0 },
            { name: "جبنة رومي", nameEn: "Romy Cheese", calories: 113, protein: 7, carbs: 1, fats: 9, fiber: 0 },
            { name: "جبنة فيتا", nameEn: "Feta Cheese", calories: 75, protein: 4, carbs: 1.2, fats: 6, fiber: 0 },
            { name: "جبنة مثلثات", nameEn: "Triangle Cheese", calories: 280, protein: 16, carbs: 4, fats: 23, fiber: 0 },
            { name: "جبنة شيدر", nameEn: "Cheddar Cheese", calories: 402, protein: 25, carbs: 1.3, fats: 33, fiber: 0 },
            { name: "جبنة قديمة", nameEn: "Aged Cheese", calories: 435, protein: 28, carbs: 2.1, fats: 36, fiber: 0 },
            { name: "جبنة بيضاء", nameEn: "White Cheese", calories: 265, protein: 17.9, carbs: 4.1, fats: 20.1, fiber: 0 },
            { name: "جبنة دمياطي", nameEn: "Damietta Cheese", calories: 334, protein: 25, carbs: 2.3, fats: 25, fiber: 0 },
            { name: "جبنة ريكفورد", nameEn: "Roquefort", calories: 369, protein: 21.5, carbs: 2, fats: 30.6, fiber: 0 },
            { name: "جبنة موتزاريلا", nameEn: "Mozzarella", calories: 300, protein: 22.2, carbs: 2.2, fats: 22.4, fiber: 0 },
            { name: "جبنة كريمي", nameEn: "Cream Cheese", calories: 342, protein: 5.9, carbs: 4.1, fats: 34.2, fiber: 0 },

            // Dairy Products
            { name: "لبن كامل الدسم", nameEn: "Whole Milk", calories: 61, protein: 3.2, carbs: 4.8, fats: 3.3, fiber: 0 },
            { name: "لبن خالي الدسم", nameEn: "Skim Milk", calories: 34, protein: 3.4, carbs: 5, fats: 0.1, fiber: 0 },
            { name: "لبن رايب", nameEn: "Buttermilk", calories: 56, protein: 3.8, carbs: 5.2, fats: 2.1, fiber: 0 },
            { name: "زبادي كامل الدسم", nameEn: "Full Fat Yogurt", calories: 61, protein: 3.5, carbs: 4.7, fats: 3.3, fiber: 0 },
            { name: "زبادي يوناني", nameEn: "Greek Yogurt", calories: 100, protein: 10, carbs: 3.6, fats: 5, fiber: 0 },
            { name: "كريمة طبخ", nameEn: "Cooking Cream", calories: 195, protein: 2.8, carbs: 3.2, fats: 20, fiber: 0 },
            { name: "كريمة خفق", nameEn: "Whipping Cream", calories: 340, protein: 2.8, carbs: 2.8, fats: 36, fiber: 0 },

            // Eggs
            { name: "بيض", nameEn: "Eggs", calories: 155, protein: 13, carbs: 1.1, fats: 11, fiber: 0 },

            // Soups
            { name: "شوربة عدس", nameEn: "Lentil Soup", calories: 116, protein: 9, carbs: 20, fats: 0.4, fiber: 7.9 },
            { name: "شوربة خضار", nameEn: "Vegetable Soup", calories: 67, protein: 2.1, carbs: 13, fats: 1.1, fiber: 2.8 },

            // Pasta & Noodles
            { name: "اندومي", nameEn: "Instant Noodles", calories: 380, protein: 8.9, carbs: 56, fats: 14, fiber: 2.8 },
            { name: "مكرونة بالصلصة", nameEn: "Pasta with Tomato Sauce", calories: 160, protein: 5.8, carbs: 30, fats: 2.5, fiber: 2.1 },
            { name: "مكرونة بالبشاميل", nameEn: "Pasta Bechamel", calories: 215, protein: 8.2, carbs: 25, fats: 9.5, fiber: 1.8 },
            { name: "مكرونة مسلوقة", nameEn: "Pasta Cooked", calories: 131, protein: 5, carbs: 25, fats: 1.1, fiber: 1.8 },

            // Rice & Grains
            { name: "أرز أبيض مسلوق", nameEn: "White Rice Cooked", calories: 130, protein: 2.7, carbs: 28, fats: 0.3, fiber: 0.4 },
            { name: "أرز بني مسلوق", nameEn: "Brown Rice Cooked", calories: 112, protein: 2.6, carbs: 22, fats: 0.9, fiber: 1.8 },
            { name: "أرز بسمتي مسلوق", nameEn: "Basmati Rice Cooked", calories: 121, protein: 3, carbs: 25, fats: 0.4, fiber: 0.6 },
            { name: "شوفان نيء", nameEn: "Raw Oats", calories: 389, protein: 16.9, carbs: 66, fats: 6.9, fiber: 10.6 },

            // All Vegetables
            { name: "طماطم", nameEn: "Tomato", calories: 18, protein: 0.9, carbs: 3.9, fats: 0.2, fiber: 1.2 },
            { name: "خيار", nameEn: "Cucumber", calories: 16, protein: 0.7, carbs: 4, fats: 0.1, fiber: 0.5 },
            { name: "خس", nameEn: "Lettuce", calories: 15, protein: 1.4, carbs: 2.9, fats: 0.2, fiber: 1.3 },
            { name: "جزر", nameEn: "Carrots", calories: 41, protein: 0.9, carbs: 10, fats: 0.2, fiber: 2.8 },
            { name: "بطاطس مسلوقة", nameEn: "Boiled Potato", calories: 87, protein: 1.9, carbs: 20, fats: 0.1, fiber: 1.8 },
            { name: "بطاطس مقلية", nameEn: "French Fries", calories: 365, protein: 4, carbs: 63, fats: 17, fiber: 3.8 },
            { name: "بطاطا مطهية", nameEn: "Sweet Potato Cooked", calories: 90, protein: 2, carbs: 21, fats: 0.2, fiber: 3.3 },
            { name: "بروكلي", nameEn: "Broccoli", calories: 34, protein: 2.8, carbs: 7, fats: 0.4, fiber: 2.6 },
            { name: "قرنبيط", nameEn: "Cauliflower", calories: 25, protein: 1.9, carbs: 5, fats: 0.3, fiber: 2 },
            { name: "كوسة", nameEn: "Zucchini", calories: 17, protein: 1.2, carbs: 3.1, fats: 0.3, fiber: 1 },
            { name: "باذنجان", nameEn: "Eggplant", calories: 25, protein: 1, carbs: 6, fats: 0.2, fiber: 3 },
            { name: "فلفل أخضر", nameEn: "Green Pepper", calories: 20, protein: 0.9, carbs: 4.6, fats: 0.2, fiber: 1.7 },
            { name: "فلفل أحمر", nameEn: "Red Pepper", calories: 31, protein: 1, carbs: 7, fats: 0.3, fiber: 2.5 },
            { name: "بصل", nameEn: "Onion", calories: 40, protein: 1.1, carbs: 9.3, fats: 0.1, fiber: 1.7 },
            { name: "ثوم", nameEn: "Garlic", calories: 149, protein: 6.4, carbs: 33, fats: 0.5, fiber: 2.1 },
            { name: "جرجير", nameEn: "Arugula", calories: 25, protein: 2.6, carbs: 3.7, fats: 0.7, fiber: 1.6 },
            { name: "فجل", nameEn: "Radish", calories: 16, protein: 0.7, carbs: 3.4, fats: 0.1, fiber: 1.6 },
            { name: "لفت", nameEn: "Turnip", calories: 28, protein: 0.9, carbs: 6.4, fats: 0.1, fiber: 1.8 },
            { name: "سبانخ", nameEn: "Spinach", calories: 23, protein: 2.9, carbs: 3.6, fats: 0.4, fiber: 2.2 },
            { name: "كرنب", nameEn: "Cabbage", calories: 25, protein: 1.3, carbs: 5.8, fats: 0.1, fiber: 2.5 },
            { name: "كرفس", nameEn: "Celery", calories: 14, protein: 0.7, carbs: 3, fats: 0.2, fiber: 1.6 },
            { name: "شبت", nameEn: "Dill", calories: 43, protein: 3.5, carbs: 7, fats: 1.1, fiber: 2.1 },
            { name: "بقدونس", nameEn: "Parsley", calories: 36, protein: 3, carbs: 6.3, fats: 0.8, fiber: 3.3 },
            { name: "كزبرة", nameEn: "Coriander", calories: 23, protein: 2.1, carbs: 3.7, fats: 0.5, fiber: 2.8 },
            { name: "نعناع", nameEn: "Mint", calories: 70, protein: 3.8, carbs: 14.9, fats: 0.9, fiber: 8 },

            // Stuffed Vegetables (المحشي)
            { name: "كوسة محشية", nameEn: "Stuffed Zucchini", calories: 165, protein: 7.8, carbs: 22, fats: 5.2, fiber: 2.8 },
            { name: "باذنجان محشي", nameEn: "Stuffed Eggplant", calories: 158, protein: 6.5, carbs: 18, fats: 7.2, fiber: 4.1 },
            { name: "فلفل محشي", nameEn: "Stuffed Peppers", calories: 142, protein: 6.8, carbs: 20, fats: 4.5, fiber: 3.2 },
            { name: "ورق عنب محشي", nameEn: "Stuffed Grape Leaves", calories: 125, protein: 4.2, carbs: 18, fats: 4.8, fiber: 2.5 },
            { name: "كرنب محشي", nameEn: "Stuffed Cabbage", calories: 138, protein: 5.8, carbs: 19, fats: 4.2, fiber: 3.1 },
            { name: "طماطم محشية", nameEn: "Stuffed Tomatoes", calories: 115, protein: 4.5, carbs: 16, fats: 4.1, fiber: 2.8 },

            // Legumes
            { name: "فاصوليا بيضاء", nameEn: "White Beans", calories: 127, protein: 9.7, carbs: 23, fats: 0.5, fiber: 6.4 },
            { name: "عدس مسلوق", nameEn: "Lentils Cooked", calories: 116, protein: 9, carbs: 20, fats: 0.4, fiber: 7.9 },
            { name: "حمص مسلوق", nameEn: "Chickpeas Cooked", calories: 164, protein: 8.9, carbs: 27, fats: 2.6, fiber: 7.6 },
            { name: "لوبيا", nameEn: "Black Eyed Peas", calories: 116, protein: 7.7, carbs: 21, fats: 0.5, fiber: 6 },
            { name: "فول أخضر", nameEn: "Green Fava Beans", calories: 88, protein: 7.9, carbs: 17.6, fats: 0.4, fiber: 7.5 },
            { name: "فاصوليا حمراء", nameEn: "Red Kidney Beans", calories: 127, protein: 8.7, carbs: 22.8, fats: 0.5, fiber: 6.4 },
            { name: "ترمس", nameEn: "Lupini Beans", calories: 371, protein: 36.2, carbs: 40.4, fats: 9.7, fiber: 18.9 },

            // All Fruits
            { name: "موز", nameEn: "Banana", calories: 89, protein: 1.1, carbs: 23, fats: 0.3, fiber: 2.6 },
            { name: "تفاح", nameEn: "Apple", calories: 52, protein: 0.3, carbs: 14, fats: 0.2, fiber: 2.4 },
            { name: "برتقال", nameEn: "Orange", calories: 47, protein: 0.9, carbs: 12, fats: 0.1, fiber: 2.4 },
            { name: "يوسفي", nameEn: "Mandarin", calories: 53, protein: 0.8, carbs: 13.3, fats: 0.3, fiber: 1.8 },
            { name: "ليمون", nameEn: "Lemon", calories: 29, protein: 1.1, carbs: 9, fats: 0.3, fiber: 2.8 },
            { name: "جريب فروت", nameEn: "Grapefruit", calories: 42, protein: 0.8, carbs: 11, fats: 0.1, fiber: 1.6 },
            { name: "عنب", nameEn: "Grapes", calories: 67, protein: 0.6, carbs: 17, fats: 0.2, fiber: 0.9 },
            { name: "بطيخ", nameEn: "Watermelon", calories: 30, protein: 0.6, carbs: 8, fats: 0.2, fiber: 0.4 },
            { name: "شمام", nameEn: "Melon", calories: 34, protein: 0.8, carbs: 8, fats: 0.2, fiber: 0.9 },
            { name: "مانجو", nameEn: "Mango", calories: 60, protein: 0.8, carbs: 15, fats: 0.4, fiber: 1.6 },
            { name: "فراولة", nameEn: "Strawberry", calories: 32, protein: 0.7, carbs: 8, fats: 0.3, fiber: 2 },
            { name: "تين", nameEn: "Figs", calories: 74, protein: 0.8, carbs: 19, fats: 0.3, fiber: 2.9 },
            { name: "تين شوكي", nameEn: "Prickly Pear", calories: 41, protein: 0.7, carbs: 9.6, fats: 0.5, fiber: 3.6 },
            { name: "بلح", nameEn: "Dates", calories: 277, protein: 1.8, carbs: 75, fats: 0.2, fiber: 6.7 },
            { name: "مشمش", nameEn: "Apricot", calories: 48, protein: 1.4, carbs: 11, fats: 0.4, fiber: 2 },
            { name: "خوخ", nameEn: "Peach", calories: 39, protein: 0.9, carbs: 10, fats: 0.3, fiber: 1.5 },
            { name: "إجاص", nameEn: "Pear", calories: 57, protein: 0.4, carbs: 15, fats: 0.1, fiber: 3.1 },
            { name: "كيوي", nameEn: "Kiwi", calories: 61, protein: 1.1, carbs: 15, fats: 0.5, fiber: 3 },
            { name: "أناناس", nameEn: "Pineapple", calories: 50, protein: 0.5, carbs: 13, fats: 0.1, fiber: 1.4 },
            { name: "رمان", nameEn: "Pomegranate", calories: 83, protein: 1.7, carbs: 19, fats: 1.2, fiber: 4 },
            { name: "جوافة", nameEn: "Guava", calories: 68, protein: 2.6, carbs: 14, fats: 1, fiber: 5.4 },
            { name: "بلح أحمر", nameEn: "Red Dates", calories: 20, protein: 0.2, carbs: 5.4, fats: 0, fiber: 0.4 },

            // Dried Fruits
            { name: "تين مجفف", nameEn: "Dried Figs", calories: 249, protein: 3.3, carbs: 63.9, fats: 0.9, fiber: 9.8 },
            { name: "مشمش مجفف", nameEn: "Dried Apricots", calories: 241, protein: 3.4, carbs: 62.6, fats: 0.5, fiber: 7.3 },
            { name: "زبيب", nameEn: "Raisins", calories: 299, protein: 3.1, carbs: 79.2, fats: 0.5, fiber: 3.7 },
            { name: "قراصيا", nameEn: "Dried Plums", calories: 240, protein: 2.2, carbs: 63.9, fats: 0.4, fiber: 7.1 },

            // All Juices & Beverages
            { name: "عصير برتقال طبيعي", nameEn: "Fresh Orange Juice", calories: 45, protein: 0.7, carbs: 10.4, fats: 0.2, fiber: 0.2 },
            { name: "عصير تفاح", nameEn: "Apple Juice", calories: 46, protein: 0.1, carbs: 11.3, fats: 0.1, fiber: 0.2 },
            { name: "عصير عنب", nameEn: "Grape Juice", calories: 60, protein: 0.4, carbs: 14.7, fats: 0.2, fiber: 0.1 },
            { name: "عصير مانجو", nameEn: "Mango Juice", calories: 60, protein: 0.4, carbs: 15, fats: 0.2, fiber: 0.4 },
            { name: "عصير جوافة", nameEn: "Guava Juice", calories: 56, protein: 0.2, carbs: 14.3, fats: 0.3, fiber: 2.9 },
            { name: "عصير أناناس", nameEn: "Pineapple Juice", calories: 53, protein: 0.5, carbs: 12.9, fats: 0.1, fiber: 0.2 },
            { name: "عصير قصب", nameEn: "Sugarcane Juice", calories: 85, protein: 0.2, carbs: 21, fats: 0.1, fiber: 0 },
            { name: "عصير ليمون", nameEn: "Lemon Juice", calories: 22, protein: 0.4, carbs: 6.9, fats: 0.2, fiber: 0.5 },
            { name: "عصير جزر", nameEn: "Carrot Juice", calories: 40, protein: 0.9, carbs: 9.3, fats: 0.2, fiber: 0.9 },
            { name: "عصير طماطم", nameEn: "Tomato Juice", calories: 17, protein: 0.8, carbs: 4.2, fats: 0.1, fiber: 0.4 },
            { name: "عصير رمان", nameEn: "Pomegranate Juice", calories: 134, protein: 0.2, carbs: 32.7, fats: 0.3, fiber: 0.1 },
            { name: "تمر هندي", nameEn: "Tamarind Juice", calories: 60, protein: 0.8, carbs: 15, fats: 0.2, fiber: 1.2 },

            // Hot Beverages
            { name: "شاي بالسكر", nameEn: "Sweet Tea", calories: 22, protein: 0, carbs: 5.7, fats: 0, fiber: 0 },
            { name: "شاي بدون سكر", nameEn: "Unsweetened Tea", calories: 2, protein: 0, carbs: 0.7, fats: 0, fiber: 0 },
            { name: "شاي بالنعناع", nameEn: "Mint Tea", calories: 25, protein: 0.1, carbs: 6.2, fats: 0, fiber: 0.1 },
            { name: "قهوة تركي", nameEn: "Turkish Coffee", calories: 25, protein: 0.3, carbs: 5.5, fats: 0.1, fiber: 0 },
            { name: "قهوة أمريكية", nameEn: "American Coffee", calories: 2, protein: 0.3, carbs: 0, fats: 0, fiber: 0 },
            { name: "نسكافيه بالحليب", nameEn: "Nescafe with Milk", calories: 85, protein: 3.2, carbs: 12, fats: 2.8, fiber: 0 },
            { name: "كركديه", nameEn: "Hibiscus", calories: 15, protein: 0.2, carbs: 3.8, fats: 0.1, fiber: 0.3 },
            { name: "عرقسوس", nameEn: "Licorice Drink", calories: 35, protein: 0.1, carbs: 9, fats: 0, fiber: 0.2 },
            { name: "شاي كشري", nameEn: "Kushary Tea", calories: 18, protein: 0.1, carbs: 4.5, fats: 0, fiber: 0 },

            // Meats & Proteins
            { name: "لحم بقري مطهي", nameEn: "Beef Cooked", calories: 250, protein: 26, carbs: 0, fats: 15, fiber: 0 },
            { name: "لحم مفروم 10% دسم", nameEn: "Ground Beef 10%", calories: 176, protein: 20, carbs: 0, fats: 10, fiber: 0 },
            { name: "لحمة ضاني", nameEn: "Lamb", calories: 294, protein: 24.5, carbs: 0, fats: 20.9, fiber: 0 },
            { name: "لحمة عجل", nameEn: "Veal", calories: 231, protein: 31, carbs: 0, fats: 10.6, fiber: 0 },
            { name: "صدر فراخ مطهي", nameEn: "Chicken Breast Cooked", calories: 165, protein: 31, carbs: 0, fats: 3.6, fiber: 0 },
            { name: "فخذ فراخ مطهي", nameEn: "Chicken Thigh Cooked", calories: 209, protein: 26, carbs: 0, fats: 11, fiber: 0 },
            { name: "فراخ مسلوق", nameEn: "Boiled Chicken", calories: 239, protein: 27, carbs: 0, fats: 13.6, fiber: 0 },
            { name: "فراخ مشوي", nameEn: "Grilled Chicken", calories: 165, protein: 31, carbs: 0, fats: 3.6, fiber: 0 },
            { name: "كبدة مطهية", nameEn: "Liver Cooked", calories: 135, protein: 20.4, carbs: 2.5, fats: 4.4, fiber: 0 },
            { name: "كبدة بقري", nameEn: "Beef Liver", calories: 135, protein: 20.4, carbs: 2.5, fats: 4.4, fiber: 0 },
            { name: "كبدة فراخ", nameEn: "Chicken Liver", calories: 167, protein: 24.5, carbs: 0.7, fats: 6.5, fiber: 0 },
            { name: "ديك رومي", nameEn: "Turkey", calories: 189, protein: 29, carbs: 0, fats: 7.4, fiber: 0 },
            { name: "حمام مشوي", nameEn: "Grilled Pigeon", calories: 294, protein: 18.5, carbs: 0, fats: 24.1, fiber: 0 },

            // Fish & Seafood
            { name: "تونة مصفاة", nameEn: "Tuna Drained", calories: 144, protein: 30, carbs: 0, fats: 1, fiber: 0 },
            { name: "سمك بوري مطهي", nameEn: "Mullet Fish Cooked", calories: 117, protein: 19, carbs: 0, fats: 3.8, fiber: 0 },
            { name: "سمك بلطي مطهي", nameEn: "Tilapia Cooked", calories: 128, protein: 26, carbs: 0, fats: 2.7, fiber: 0 },
            { name: "سمك سلمون", nameEn: "Salmon", calories: 208, protein: 20, carbs: 0, fats: 13.4, fiber: 0 },
            { name: "سمك ماكريل", nameEn: "Mackerel", calories: 205, protein: 18.6, carbs: 0, fats: 13.9, fiber: 0 },
            { name: "سمك سردين", nameEn: "Sardines", calories: 208, protein: 24.6, carbs: 0, fats: 11.5, fiber: 0 },
            { name: "جمبري مطهي", nameEn: "Shrimp Cooked", calories: 99, protein: 18, carbs: 0.2, fats: 1.7, fiber: 0 },
            { name: "كابوريا", nameEn: "Crab", calories: 97, protein: 19.4, carbs: 0, fats: 1.5, fiber: 0 },
            { name: "استاكوزا", nameEn: "Lobster", calories: 89, protein: 19, carbs: 0, fats: 0.9, fiber: 0 },
            { name: "حبار", nameEn: "Squid", calories: 92, protein: 15.6, carbs: 3.1, fats: 1.4, fiber: 0 },

            // Processed Foods
            { name: "مرتديلا", nameEn: "Mortadella", calories: 311, protein: 16.4, carbs: 1.2, fats: 25.4, fiber: 0 },
            { name: "لانشون", nameEn: "Luncheon", calories: 310, protein: 12, carbs: 3, fats: 28, fiber: 0 },
            { name: "بسطرمة", nameEn: "Pastrami", calories: 154, protein: 24, carbs: 1, fats: 5.5, fiber: 0 },

            // Pickles and Preserved Foods
            { name: "مخلل", nameEn: "Pickles", calories: 11, protein: 0.3, carbs: 2.3, fats: 0.2, fiber: 1.2 },
            { name: "مخلل خيار", nameEn: "Pickled Cucumber", calories: 11, protein: 0.3, carbs: 2.3, fats: 0.2, fiber: 1.2 },
            { name: "مخلل لفت", nameEn: "Pickled Turnip", calories: 18, protein: 0.5, carbs: 4.1, fats: 0.1, fiber: 1.8 },
            { name: "مخلل جزر", nameEn: "Pickled Carrot", calories: 25, protein: 0.6, carbs: 6, fats: 0.1, fiber: 2.1 },
            { name: "زيتون أخضر", nameEn: "Green Olives", calories: 115, protein: 0.8, carbs: 6, fats: 11, fiber: 3.2 },
            { name: "زيتون أسود", nameEn: "Black Olives", calories: 115, protein: 0.8, carbs: 6, fats: 11, fiber: 3.2 },

            // Oils & Fats
            { name: "زيت زيتون", nameEn: "Olive Oil", calories: 884, protein: 0, carbs: 0, fats: 100, fiber: 0 },
            { name: "زيت ذرة", nameEn: "Corn Oil", calories: 884, protein: 0, carbs: 0, fats: 100, fiber: 0 },
            { name: "زبدة", nameEn: "Butter", calories: 717, protein: 0.9, carbs: 0.1, fats: 81, fiber: 0 },

            // Nuts & Seeds
            { name: "فول سوداني", nameEn: "Peanuts", calories: 567, protein: 26, carbs: 16, fats: 49, fiber: 8.5 },
            { name: "لوز", nameEn: "Almonds", calories: 579, protein: 21, carbs: 22, fats: 50, fiber: 12 },
            { name: "عين جمل", nameEn: "Walnuts", calories: 654, protein: 15, carbs: 14, fats: 65, fiber: 6.7 },
            { name: "فستق", nameEn: "Pistachios", calories: 560, protein: 20, carbs: 28, fats: 45, fiber: 10 },
            { name: "كاجو", nameEn: "Cashews", calories: 553, protein: 18, carbs: 30, fats: 44, fiber: 3.3 },
            { name: "بندق", nameEn: "Hazelnuts", calories: 628, protein: 15, carbs: 17, fats: 61, fiber: 9.7 },
            { name: "صنوبر", nameEn: "Pine Nuts", calories: 673, protein: 13.7, carbs: 13.1, fats: 68.4, fiber: 3.7 },
            { name: "بذور عباد الشمس", nameEn: "Sunflower Seeds", calories: 584, protein: 20.8, carbs: 20, fats: 51.5, fiber: 8.6 },
            { name: "بذور يقطين", nameEn: "Pumpkin Seeds", calories: 559, protein: 30.2, carbs: 10.7, fats: 49, fiber: 6 },

            // Egyptian Desserts & Sweets
            { name: "كنافة", nameEn: "Kunafa", calories: 520, protein: 10.5, carbs: 65, fats: 24, fiber: 2.1 },
            { name: "بقلاوة", nameEn: "Baklava", calories: 517, protein: 9, carbs: 60, fats: 28, fiber: 3.5 },
            { name: "بسبوسة", nameEn: "Basbousa", calories: 385, protein: 6.8, carbs: 55, fats: 16, fiber: 2.2 },
            { name: "مهلبية", nameEn: "Muhallabia", calories: 168, protein: 4.2, carbs: 25, fats: 6.5, fiber: 0.3 },
            { name: "أرز بلبن", nameEn: "Rice Pudding", calories: 155, protein: 4.1, carbs: 28, fats: 3.2, fiber: 0.4 },
            { name: "زلابية", nameEn: "Zalabia", calories: 425, protein: 6.5, carbs: 58, fats: 18, fiber: 1.8 },
            { name: "قطايف", nameEn: "Qatayef", calories: 298, protein: 7.2, carbs: 48, fats: 9.5, fiber: 2.1 },
            { name: "أم علي", nameEn: "Om Ali", calories: 445, protein: 12.8, carbs: 52, fats: 21, fiber: 3.2 },
            { name: "عاشورة", nameEn: "Ashure", calories: 185, protein: 5.2, carbs: 38, fats: 2.8, fiber: 4.1 },
            { name: "مديدة", nameEn: "Madida", calories: 385, protein: 6.2, carbs: 58, fats: 14.8, fiber: 2.1 },
            { name: "هريسة", nameEn: "Harissa Sweet", calories: 425, protein: 8.5, carbs: 62, fats: 16.2, fiber: 3.1 },
            { name: "بلح الشام", nameEn: "Balah El Sham", calories: 398, protein: 6.8, carbs: 55, fats: 17.2, fiber: 1.8 },
            { name: "لقمة القاضي", nameEn: "Lokmat El Qadi", calories: 365, protein: 5.2, carbs: 48, fats: 16.8, fiber: 1.2 },
            { name: "عوامة", nameEn: "Awama", calories: 375, protein: 5.8, carbs: 52, fats: 15.8, fiber: 1.5 },

            // Condiments & Others
            { name: "عسل نحل", nameEn: "Honey", calories: 304, protein: 0.3, carbs: 82, fats: 0, fiber: 0.2 },
            { name: "سكر أبيض", nameEn: "White Sugar", calories: 387, protein: 0, carbs: 100, fats: 0, fiber: 0 },
            { name: "مايونيز عادي", nameEn: "Regular Mayonnaise", calories: 680, protein: 1, carbs: 0.6, fats: 75, fiber: 0 },
            { name: "كاتشب", nameEn: "Ketchup", calories: 112, protein: 1.7, carbs: 27, fats: 0.4, fiber: 0.4 },
            { name: "سلطة", nameEn: "Mixed Salad", calories: 35, protein: 1.8, carbs: 7.2, fats: 0.3, fiber: 2.8 },
            { name: "بابا غنوج", nameEn: "Baba Ganoush", calories: 168, protein: 4.2, carbs: 12, fats: 12.5, fiber: 4.8 },
            { name: "حمص بالطحينة", nameEn: "Hummus", calories: 177, protein: 8, carbs: 20, fats: 8, fiber: 6 },

            // Street Food
            { name: "شاورما", nameEn: "Shawarma", calories: 265, protein: 22.8, carbs: 15, fats: 14.2, fiber: 1.8 },
            { name: "كباب", nameEn: "Kebab", calories: 288, protein: 25.6, carbs: 2.5, fats: 19.8, fiber: 0.5 },
            { name: "كفتة", nameEn: "Kofta", calories: 275, protein: 24.2, carbs: 3.8, fats: 18.5, fiber: 0.8 },
            { name: "حواوشي", nameEn: "Hawawshi", calories: 315, protein: 16.8, carbs: 28, fats: 16.2, fiber: 2.5 },
            { name: "ساندويتش فول", nameEn: "Foul Sandwich", calories: 285, protein: 12.5, carbs: 48, fats: 6.2, fiber: 8.5 },
            { name: "ساندويتش طعمية", nameEn: "Falafel Sandwich", calories: 320, protein: 11.8, carbs: 42, fats: 13.5, fiber: 6.2 }
        ];

        // Application State
        let meals = {};
        let mealCounter = 0;

        // Initialize the application
        document.addEventListener('DOMContentLoaded', function() {
            loadSavedData();
            updateTotals();
        });

        // Add new meal function
        function addNewMeal() {
            const mealNameInput = document.getElementById('new-meal-name');
            const mealName = mealNameInput.value.trim();

            if (!mealName) {
                showNotification('الرجاء إدخال اسم الوجبة', 'error');
                return;
            }

            mealCounter++;
            const mealId = 'meal_' + mealCounter;
            meals[mealId] = [];

            const container = document.getElementById('meals-container');
            const mealDiv = document.createElement('div');
            mealDiv.className = 'meal-section';
            mealDiv.id = mealId;

            mealDiv.innerHTML = `
                <div class="meal-header">
                    <span>${mealName}</span>
                    <button class="remove-btn" onclick="removeMeal('${mealId}')" style="margin-left: 10px;">حذف الوجبة</button>
                    <span id="${mealId}-total">0 سعرة</span>
                </div>
                <div class="meal-content">
                    <div class="add-food-section">
                        <div class="search-container">
                            <input type="text" class="search-input" placeholder="ابحث عن الطعام..." 
                                   onkeyup="searchFoods(this, '${mealId}')" onfocus="showResults('${mealId}')">
                            <div class="search-results" id="search-results-${mealId}"></div>
                        </div>
                        <div class="quantity-container">
                            <label>الكمية (جرام):</label>
                            <input type="number" class="quantity-input" id="quantity-${mealId}" value="100" min="1">
                            <button class="add-btn" onclick="addSelectedFood('${mealId}')">إضافة</button>
                        </div>
                    </div>
                    <div class="table-container">
                        <table class="food-table">
                            <thead>
                                <tr>
                                    <th>الطعام</th>
                                    <th>الكمية</th>
                                    <th>السعرات</th>
                                    <th>البروتين</th>
                                    <th>الكارب</th>
                                    <th>الدهون</th>
                                    <th>الألياف</th>
                                    <th>حذف</th>  
                                </tr>
                            </thead>
                            <tbody id="${mealId}-foods">
                            </tbody>
                        </table>
                    </div>
                </div>
            `;
            container.appendChild(mealDiv);

            mealNameInput.value = '';
            showNotification('تم إضافة الوجبة بنجاح');
            saveData();
        }

        // Remove meal function
        function removeMeal(mealId) {
            showConfirmModal(
                '🗑️',
                'حذف الوجبة',
                'هل أنت متأكد من حذف هذه الوجبة؟ سيتم حذف جميع الأطعمة المضافة لها.',
                function() {
                    delete meals[mealId];
                    document.getElementById(mealId).remove();
                    updateTotals();
                    saveData();
                    showNotification('تم حذف الوجبة بنجاح');
                }
            );
        }

        // Search foods functionality
        function searchFoods(input, mealId) {
            const query = input.value.toLowerCase().trim();
            const resultsContainer = document.getElementById(`search-results-${mealId}`);

            if (query.length < 2) {
                resultsContainer.style.display = 'none';
                return;
            }

            const filteredFoods = egyptianFoodsDatabase.filter(food => 
                food.name.toLowerCase().includes(query) || 
                food.nameEn.toLowerCase().includes(query));

            resultsContainer.innerHTML = '';
            filteredFoods.slice(0, 10).forEach(food => {
                const div = document.createElement('div');
                div.className = 'search-result-item';
                div.textContent = `${food.name} (${food.nameEn})`;
                div.onclick = () => selectFood(food, mealId);
                resultsContainer.appendChild(div);
            });

            resultsContainer.style.display = filteredFoods.length > 0 ? 'block' : 'none';
        }

        // Show search results
        function showResults(mealId) {
            const input = document.querySelector(`#${mealId} .search-input`);
            if (input && input.value.length >= 2) {
                searchFoods(input, mealId);
            }
        }

        // Select food from search results
        let selectedFoods = {};

        function selectFood(food, mealId) {
            selectedFoods[mealId] = food;
            const input = document.querySelector(`#${mealId} .search-input`);
            input.value = food.name;
            document.getElementById(`search-results-${mealId}`).style.display = 'none';
        }

        // Add selected food to meal
        function addSelectedFood(mealId) {
            const selectedFood = selectedFoods[mealId];
            const quantity = parseFloat(document.getElementById(`quantity-${mealId}`).value) || 100;

            if (!selectedFood) {
                showNotification('الرجاء اختيار طعام أولاً', 'error');
                return;
            }

            if (quantity <= 0) {
                showNotification('الرجاء إدخال كمية صحيحة', 'error');
                return;
            }

            // Calculate nutritional values based on quantity
            const multiplier = quantity / 100;
            const foodItem = {
                id: Date.now() + Math.random(),
                name: selectedFood.name,
                quantity: quantity,
                calories: Math.round(selectedFood.calories * multiplier),
                protein: Math.round(selectedFood.protein * multiplier * 10) / 10,
                carbs: Math.round(selectedFood.carbs * multiplier * 10) / 10,
                fats: Math.round(selectedFood.fats * multiplier * 10) / 10,
                fiber: Math.round(selectedFood.fiber * multiplier * 10) / 10
            };

            meals[mealId].push(foodItem);
            updateMealDisplay(mealId);
            updateTotals();
            saveData();

            // Clear inputs
            document.querySelector(`#${mealId} .search-input`).value = '';
            document.getElementById(`quantity-${mealId}`).value = '100';
            selectedFoods[mealId] = null;

            showNotification('تم إضافة الطعام بنجاح');
        }

        // Update meal display
        function updateMealDisplay(mealId) {
            const tbody = document.getElementById(`${mealId}-foods`);
            const foods = meals[mealId] || [];

            tbody.innerHTML = '';
            let mealTotal = 0;

            foods.forEach(food => {
                mealTotal += food.calories;
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${food.name}</td>
                    <td>${food.quantity}جم</td>
                    <td>${food.calories}</td>
                    <td>${food.protein}جم</td>
                    <td>${food.carbs}جم</td>
                    <td>${food.fats} جم</td>
                    <td>${food.fiber}جم</td>
                    <td><button class="remove-btn" onclick="removeFood('${mealId}', '${food.id}')">حذف</button></td>
                `;
                tbody.appendChild(row);
            });

            const totalElement = document.getElementById(`${mealId}-total`);
            if (totalElement) {
                totalElement.textContent = `${mealTotal} سعرة`;
            }
        }

        // Remove food from meal
        function removeFood(mealId, foodId) {
            meals[mealId] = meals[mealId].filter(food => food.id != foodId);
            updateMealDisplay(mealId);
            updateTotals();
            saveData();
            showNotification('تم حذف الطعام');
        }

        // Update daily totals
        function updateTotals() {
            let totalCalories = 0, totalProtein = 0, totalCarbs = 0, totalFats = 0, totalFiber = 0;

            Object.values(meals).forEach(meal => {
                meal.forEach(food => {
                    totalCalories += food.calories;
                    totalProtein += food.protein;
                    totalCarbs += food.carbs;
                    totalFats += food.fats;
                    totalFiber += food.fiber;
                });
            });

            document.getElementById('total-calories').textContent = Math.round(totalCalories);
            document.getElementById('total-protein').textContent = Math.round(totalProtein * 10) / 10;
            document.getElementById('total-carbs').textContent = Math.round(totalCarbs * 10) / 10;
            document.getElementById('total-fats').textContent = Math.round(totalFats * 10) / 10;
            document.getElementById('total-fiber').textContent = Math.round(totalFiber * 10) / 10;
        }

        // Save data to localStorage
        function saveData() {
            localStorage.setItem('popeyeGymMeals', JSON.stringify(meals));
            localStorage.setItem('popeyeGymMealCounter', mealCounter.toString());
        }

        // Load saved data
        function loadSavedData() {
            const savedData = localStorage.getItem('popeyeGymMeals');
            const savedCounter = localStorage.getItem('popeyeGymMealCounter');

            if (savedData) {
                meals = JSON.parse(savedData);
                mealCounter = savedCounter ? parseInt(savedCounter) : 0;

                // Recreate meal sections
                Object.keys(meals).forEach(mealId => {
                    // Extract meal name from saved data or use default
                    const mealName = `وجبة ${mealId}`;
                    createMealSection(mealId, mealName);
                    updateMealDisplay(mealId);
                });
            }
        }

        // Create meal section helper
        function createMealSection(mealId, mealName) {
            const container = document.getElementById('meals-container');
            const mealDiv = document.createElement('div');
            mealDiv.className = 'meal-section';
            mealDiv.id = mealId;
            mealDiv.innerHTML = `
                <div class="meal-header">
                    <span>${mealName}</span>
                    <button class="remove-btn" onclick="removeMeal('${mealId}')" style="margin-left: 10px;">حذف الوجبة</button>
                    <span id="${mealId}-total">0 سعرة</span>
                </div>
                <div class="meal-content">
                    <div class="add-food-section">
                        <div class="search-container">
                            <input type="text" class="search-input" placeholder="ابحث عن الطعام..." 
                                   onkeyup="searchFoods(this, '${mealId}')" onfocus="showResults('${mealId}')">
                            <div class="search-results" id="search-results-${mealId}"></div>
                        </div>
                        <div class="quantity-container">
                            <label>الكمية (جرام):</label>
                            <input type="number" class="quantity-input" id="quantity-${mealId}" value="100" min="1">
                            <button class="add-btn" onclick="addSelectedFood('${mealId}')">إضافة</button>
                        </div>
                    </div>
                    <div class="table-container">
                        <table class="food-table">
                            <thead>
                                <tr>
                                    <th>الطعام</th>
                                    <th>الكمية</th>
                                    <th>السعرات</th>
                                    <th>البروتين</th>
                                    <th>الكارب</th>
                                    <th>الدهون</th>
                                    <th>الألياف</th>
                                    <th>حذف</th>
                                </tr>
                            </thead>
                            <tbody id="${mealId}-foods">
                                <!-- Foods will be added here -->
                            </tbody>
                        </table>
                    </div>
                </div>
            `;
            container.appendChild(mealDiv);
        }

        // Save day functionality
        function saveDay() {
            const today = new Date().toISOString().split('T')[0];
            const dayData = {
                date: today,
                meals: meals,
                totals: {
                    calories: document.getElementById('total-calories').textContent,
                    protein: document.getElementById('total-protein').textContent,
                    carbs: document.getElementById('total-carbs').textContent,
                    fats: document.getElementById('total-fats').textContent,
                    fiber: document.getElementById('total-fiber').textContent
                }
            };

            localStorage.setItem(`popeyeGymDay_${today}`, JSON.stringify(dayData));
            showNotification('تم حفظ بيانات اليوم بنجاح');
        }

        // Notification system
        function showNotification(message, type = 'success') {
            // Remove existing notification
            const existingNotification = document.querySelector('.notification');
            if (existingNotification) {
                existingNotification.remove();
            }

            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.textContent = message;
            document.body.appendChild(notification);

            // Show notification
            setTimeout(() => {
                notification.classList.add('show');
            }, 100);

            // Hide notification after 3 seconds
            setTimeout(() => {
                notification.classList.remove('show');
                setTimeout(() => {
                    if (notification.parentElement) {
                        notification.remove();
                    }
                }, 300);
            }, 3000);
        }

        // Clear all meals with custom modal
        function clearAll() {
            showConfirmModal(
                '⚠️',
                'تأكيد الحذف',
                'هل أنت متأكد من حذف جميع الوجبات؟ لا يمكن التراجع عن هذا الإجراء.',
                function() {
                    meals = {};
                    mealCounter = 0;
                    document.getElementById('meals-container').innerHTML = '';
                    updateTotals();
                    saveData();
                    showNotification('تم مسح جميع الوجبات بنجاح');
                }
            );
        }

        // Custom confirmation modal
        function showConfirmModal(icon, title, message, onConfirm) {
            const modalHTML = `
                <div class="modal-overlay" id="confirmModal">
                    <div class="modal-content">
                        <div class="modal-icon">${icon}</div>
                        <div class="modal-title">${title}</div>
                        <div class="modal-message">${message}</div>
                        <div class="modal-buttons">
                            <button class="modal-btn modal-btn-confirm" onclick="confirmAction()">
                                نعم، احذف الكل
                            </button>
                            <button class="modal-btn modal-btn-cancel" onclick="cancelAction()">
                                إلغاء
                            </button>
                        </div>
                    </div>
                </div>
            `;

            document.body.insertAdjacentHTML('beforeend', modalHTML);

            // Store the callback function
            window.currentConfirmAction = onConfirm;

            // Close modal when clicking outside
            document.getElementById('confirmModal').addEventListener('click', function(e) {
                if (e.target === this) {
                    cancelAction();
                }
            });
        }

        function confirmAction() {
            const modal = document.getElementById('confirmModal');
            if (modal) {
                modal.remove();
            }
            if (window.currentConfirmAction) {
                window.currentConfirmAction();
                window.currentConfirmAction = null;
            }
        }

        function cancelAction() {
            const modal = document.getElementById('confirmModal');
            if (modal) {
                modal.remove();
            }
            window.currentConfirmAction = null;
        }

        // Download PDF function
        function downloadPDF() {
            const totalCalories = document.getElementById('total-calories').textContent;
            const totalProtein = document.getElementById('total-protein').textContent;
            const totalCarbs = document.getElementById('total-carbs').textContent;
            const totalFats = document.getElementById('total-fats').textContent;
            const totalFiber = document.getElementById('total-fiber').textContent;

            // Create HTML content for better Arabic text rendering
            const htmlContent = `<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>تقرير حاسبة سعرات الطعام - Popeye GYM</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            direction: rtl;
            text-align: right;
            margin: 20px;
            background: #f8f9fa;
            color: #333;
            line-height: 1.6;
        }
        .header {
            background: linear-gradient(135deg, #dc2626 0%, #b91c1c 100%);
            color: white;
            padding: 30px;
            border-radius: 15px;
            text-align: center;
            margin-bottom: 20px;
            position: relative;
        }

        .gym-title {
            font-size: 54px;
            font-weight: bold;
            text-shadow: 3px 3px 6px rgba(0,0,0,0.4);
            margin: 0;
            color: white;
        }
        .subtitle {
            font-size: 20px;
            opacity: 0.95;
            margin: 10px 0 5px 0;
        }
        .date-info {
            font-size: 16px;
            opacity: 0.9;
            margin: 5px 0 0 0;
        }
        .totals {
            background: white;
            padding: 25px;
            border-radius: 15px;
            margin-bottom: 25px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            border: 2px solid #dc2626;
        }
        .totals h2 {
            color: #dc2626;
            border-bottom: 3px solid #dc2626;
            padding-bottom: 15px;
            margin-bottom: 20px;
            font-size: 28px;
        }
        .total-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }
        .total-item {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            border: 2px solid #dc2626;
        }
        .total-value {
            font-size: 32px;
            font-weight: bold;
            color: #dc2626;
            margin-bottom: 5px;
        }
        .total-label {
            font-size: 16px;
            color: #666;
            font-weight: 500;
        }
        .meals {
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            border: 2px solid #dc2626;
        }
        .meals h2 {
            color: #dc2626;
            border-bottom: 3px solid #dc2626;
            padding-bottom: 15px;
            margin-bottom: 20px;
            font-size: 28px;
        }
        .meal {
            margin-bottom: 25px;
            padding: 20px;
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border-radius: 10px;
            border: 1px solid #dc2626;
        }
        .meal h3 {
            color: #dc2626;
            margin-bottom: 15px;
            font-size: 22px;
        }
        .food-item {
            padding: 10px 0;
            border-bottom: 1px solid #e9ecef;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .food-item:last-child {
            border-bottom: none;
        }
        .food-name {
            font-weight: bold;
            font-size: 16px;
        }
        .food-details {
            color: #666;
            font-size: 14px;
            margin-top: 3px;
        }
        .food-calories {
            font-weight: bold;
            color: #dc2626;
            font-size: 16px;
        }
        @media print {
            body { margin: 0; }
            .header { margin-bottom: 15px; }
        }
        @media (max-width: 768px) {
            body { margin: 15px; }
            .total-grid { grid-template-columns: repeat(2, 1fr); }
            .gym-title { font-size: 36px; }
            .logo-img { width: 70px; height: 70px; }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1 class="gym-title">Popeye GYM</h1>
        <p class="subtitle">تقرير حاسبة سعرات الطعام</p>
        <p class="date-info">التاريخ: ${new Date().toLocaleDateString('ar-EG', { 
            weekday: 'long', 
            year: 'numeric', 
            month: 'long', 
            day: 'numeric' 
        })}</p>
    </div>

    <div class="totals">
        <h2>المجموع اليومي</h2>
        <div class="total-grid">
            <div class="total-item">
                <div class="total-value">${totalCalories}</div>
                <div class="total-label">السعرات الحرارية</div>
            </div>
            <div class="total-item">
                <div class="total-value">${totalProtein} جم</div>
                <div class="total-label">البروتين</div>
            </div>
            <div class="total-item">
                <div class="total-value">${totalCarbs} جم</div>
                <div class="total-label">الكربوهيدرات</div>
            </div>
            <div class="total-item">
                <div class="total-value">${totalFats} جم</div>
                <div class="total-label">الدهون</div>
            </div>
            <div class="total-item">
                <div class="total-value">${totalFiber} جم</div>
                <div class="total-label">الألياف</div>
            </div>
        </div>
    </div>`;

            let htmlMealsContent = '';

            // Add meal details
            if (Object.keys(meals).some(mealId => meals[mealId].length > 0)) {
                htmlMealsContent += `<div class="meals"><h2>🍽️ تفاصيل الوجبات</h2>`;

                Object.keys(meals).forEach((mealId, index) => {
                    if (meals[mealId].length > 0) {
                        let mealCalories = meals[mealId].reduce((sum, food) => sum + food.calories, 0);
                        htmlMealsContent += `
                            <div class="meal">
                                <h3>الوجبة ${index + 1} (${mealCalories} سعرة)</h3>`;

                        meals[mealId].forEach(food => {
                            htmlMealsContent += `
                                <div class="food-item">
                                    <div>
                                        <div class="food-name">${food.name}</div>
                                        <div class="food-details">
                                            البروتين: ${food.protein}جم | الكارب: ${food.carbs}جم | الدهون: ${food.fats}جم
                                        </div>
                                    </div>
                                    <div style="text-align: left;">
                                        <strong>${food.quantity}جم</strong><br>
                                        <span style="color: #dc2626;">${food.calories} سعرة</span>
                                    </div>
                                </div>`;
                        });
                        htmlMealsContent += `</div>`;
                    }
                });
                htmlMealsContent += `</div>`;
            }

            const finalHtmlContent = htmlContent + htmlMealsContent + `
                </body>
                </html>`;

            // Create and download HTML file
            const blob = new Blob([finalHtmlContent], { type: 'text/html;charset=utf-8' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `Popeye-GYM-تقرير-${new Date().toISOString().split('T')[0]}.html`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);

            showNotification('تم تحميل التقرير بنجاح! يمكنك طباعته كـ PDF من المتصفح');
        }

        // Download as image function
        function downloadImage() {
            const canvas = document.createElement('canvas');
            const ctx = canvas.getContext('2d');

            // Set high quality canvas
            const scaleFactor = 2;
            canvas.width = 800 * scaleFactor;
            canvas.height = 1200 * scaleFactor;
            ctx.scale(scaleFactor, scaleFactor);

            // Background
            ctx.fillStyle = '#ffffff';
            ctx.fillRect(0, 0, 800, 1200);

            // Header background
            const gradient = ctx.createLinearGradient(0, 0, 800, 120);
            gradient.addColorStop(0, '#dc2626');
            gradient.addColorStop(1, '#b91c1c');
            ctx.fillStyle = gradient;
            ctx.fillRect(0, 0, 800, 120);

            // Load and draw logo
            const logo = new Image();
            logo.onload = function() {
                // Draw logo on the left side
                const logoSize = 60;
                ctx.drawImage(logo, 50, 30, logoSize, logoSize);

                // Header text with logo
                ctx.fillStyle = '#ffffff';
                ctx.font = 'bold 36px Arial, sans-serif';
                ctx.textAlign = 'left';
                ctx.fillText('Popeye GYM', 130, 55);

                ctx.font = '20px Arial, sans-serif';
                ctx.fillText('حاسبة سعرات الطعام', 130, 80);

                ctx.font = '16px Arial, sans-serif';
                ctx.textAlign = 'center';
                ctx.fillText(`التاريخ: ${new Date().toLocaleDateString('ar-EG', { 
                    weekday: 'long', 
                    year: 'numeric', 
                    month: 'long', 
                    day: 'numeric' 
                })}`, 400, 105);

                // Continue with the rest of the image generation
                generateRestOfImage();
            };
            logo.src = 'images/logo.png';

            function generateRestOfImage() {

            // Totals section
                let y = 160;
            ctx.fillStyle = '#dc2626';
            ctx.font = 'bold 24px Arabic UI, Arial, sans-serif';
            ctx.textAlign = 'center';
            ctx.fillText('📊 المجموع اليومي', 400, y);

            // Draw totals box
            ctx.fillStyle = '#f8f9fa';
            ctx.fillRect(50, y + 20, 700, 160);
            ctx.strokeStyle = '#e9ecef';
            ctx.lineWidth = 2;
            ctx.strokeRect(50, y + 20, 700, 160);

            y += 50;
            ctx.fillStyle = '#333333';
            ctx.font = '18px Arabic UI, Arial, sans-serif';

            const totalCalories = document.getElementById('total-calories').textContent;
            const totalProtein = document.getElementById('total-protein').textContent;
            const totalCarbs = document.getElementById('total-carbs').textContent;
            const totalFats = document.getElementById('total-fats').textContent;
            const totalFiber = document.getElementById('total-fiber').textContent;

            const totals = [
                `السعرات الحرارية: ${totalCalories}`,
                `البروتين: ${totalProtein} جم`,
                `الكربوهيدرات: ${totalCarbs} جم`,
                `الدهون: ${totalFats} جم`,
                `الألياف: ${totalFiber} جم`
            ];

            totals.forEach(total => {
                ctx.fillText(total, 400, y);
                y += 25;
            });

            // Meals details section
            y += 40;
            ctx.fillStyle = '#dc2626';
            ctx.font = 'bold 22px Arabic UI, Arial, sans-serif';
            ctx.textAlign = 'center';
            ctx.fillText('🍽️ تفاصيل الوجبات', 400, y);
            y += 30;

            ctx.fillStyle = '#333333';
            ctx.font = '16px Arabic UI, Arial, sans-serif';
            ctx.textAlign = 'right';

            // Check if there are meals to display
            let hasMeals = false;
            Object.keys(meals).forEach(mealId => {
                if (meals[mealId].length > 0) {
                    hasMeals = true;
                }
            });

            if (hasMeals) {
                Object.keys(meals).forEach((mealId, index) => {
                    if (meals[mealId].length > 0 && y < 1100) {
                        let mealCalories = meals[mealId].reduce((sum, food) => sum + food.calories, 0);

                        ctx.font = 'bold 18px Arabic UI, Arial, sans-serif';
                        ctx.fillText(`الوجبة ${index + 1} (${mealCalories} سعرة):`, 750, y);
                        y += 25;

                        ctx.font = '14px Arabic UI, Arial, sans-serif';
                        meals[mealId].forEach(food => {
                            if (y < 1150) {
                                const text = `• ${food.name}: ${food.quantity}جم - ${food.calories} سعرة`;
                                ctx.fillText(text, 730, y);
                                y += 20;
                            }
                        });
                        y += 15;
                    }
                });
            } else {
                ctx.font = '16px Arabic UI, Arial, sans-serif';
                ctx.textAlign = 'center';
                ctx.fillStyle = '#666666';
                ctx.fillText('لا توجد وجبات مضافة', 400, y);
            }

            // Convert canvas to blob and download
                canvas.toBlob(function(blob) {
                    const url = URL.createObjectURL(blob);
                    const link = document.createElement('a');
                    link.download = `Popeye-GYM-تقرير-${new Date().toISOString().split('T')[0]}.png`;
                    link.href = url;
                    document.body.appendChild(link);
                    link.click();
                    document.body.removeChild(link);
                    URL.revokeObjectURL(url);

                    showNotification('تم تحميل الصورة بنجاح! ✅');
                }, 'image/png', 1.0);
            }
        }

        // Close search results when clicking outside
        document.addEventListener('click', function(event) {
            if (!event.target.closest('.search-container')) {
                document.querySelectorAll('.search-results').forEach(results => {
                    results.style.display = 'none';
                });
            }
        });

        // Handle Enter key in search inputs
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Enter' && e.target.classList.contains('search-input')) {
                e.preventDefault();
                const mealSection = e.target.closest('.meal-section');
                const mealId = mealSection.id;

                const firstResult = document.querySelector(`#search-results-${mealId} .search-result-item`);
                if (firstResult) {
                    firstResult.click();
                }
            }
        });
</script>
</body>
</html>
